<!DOCTYPE html>
<html>
    <head>

      <meta charset="utf-8">
      <title>Io | Beta</title>
      <link rel="shortcut icon" href="https://i.ibb.co/NndQnFV/temp.png" >

    </head>
    <style>
    
        body {

            background-color: white;

        }
   
        #me {

            display: block;
            margin: auto

        }

        p {

            width: 25%;
            text-align: center;
            margin: auto;
            font-family: Arial, Helvetica, sans-serif

        }

    </style>
    <body>

        <canvas id="me" >Start streaming on a modern browser!</canvas>
        <p>#MadeWithIo</p>

    </body>
    <script>

        window.touchCheck = function() {
            
            var check = false
            (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera)
            return check

        };

        var el = document.getElementById("me")
            el.width = window.innerWidth*0.95
            el.height = window.innerHeight*0.9
            if ( el.width < el.height )
            {
                el.height = 2/3*el.width
            }
            else {
                el.width = el.height
                el.height*=2/3
            }

        var c = el.getContext("2d")
            var w = c.canvas.width
            var h = c.canvas.height

  
        var x_Ra = [-1, 1]
        var y_Ra = [-1, 1]

        var theta = 1
        var alpha = 0.25
        var beta = 0.01
        var rotationSpeed = alpha*Math.PI/30

        var lightSources = [[-1, -1, 0.5], [-1, 1, 0.5], [1, -1, 0.5], [1, 1, 0.5]]
        var luminosity = 2
        var distW = 2
        var shininess = 2
        
        var f1 = function(x)
        {return Math.sqrt(-Math.pow(x, 2)+1)}
        var f2 = function(x)
        {return -Math.sqrt(-Math.pow(x, 2)+1)}

        var i_hat = [1, 0]
        var j_hat = [0, 1]

            if ( Math.tan(theta) >= 0 )
            {

                if ( theta > Math.PI )
                {

                    i_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f2(i_hat[0])

                }
                else {

                    i_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f1(i_hat[0])

                }

            }
            else
            {

                if ( theta > Math.PI )
                {
                
                    i_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f2(i_hat[0])

                }
                else {

                    i_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f1(i_hat[0])

                }  

            }

            var nTheta = theta+Math.PI/2
            if ( Math.tan(nTheta) >= 0 )
            {

                if ( nTheta > Math.PI )
                {

                    j_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f2(j_hat[0])

                }
                else {
                    
                    j_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f1(j_hat[0])

                }

            }
            else
            {

                if ( nTheta > Math.PI )
                {

                    j_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f2(j_hat[0])

                }
                else {
                    
                    j_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f1(j_hat[0])

                }  

            }


        var mini = function(x)
        {

            return 1/(1+Math.exp(-x+2.5))

        }
        var blend = function(hue, int)
        {

            var mi = 0
            var max = 0
            for ( var i = 0; i < hue.length; i++ )
            {

                if ( hue[i] > max )
                {

                    mi = i
                    max = hue[i]

                }

            }
            r = [255*int*hue[0]/hue[mi], 255*int*hue[1]/hue[mi], 255*int*hue[2]/hue[mi]]
            return r

        }
        var co = function(rad)
        {

            if ( rad > Math.PI/2 ){ return -(rad-Math.PI/2)+Math.PI/2 }
            else if ( rad < -Math.PI ){ return (rad-Math.PI/2)-Math.PI/2 }
            else { return rad }

        }
        var brightness = function(x, y, z, lTheta, lPhi)
        {

            var avgx = x_Ra[1]/2
            var avgy = y_Ra[1]/2
            var dist = (Math.pow(avgx, 2)+Math.pow(avgy, 2))
            var displacements = []
            var angSThetas = []
            var angSPhis = []
            var angLThetas = []
            var angLPhis = []

            for ( var i = 0; i < lightSources.length; i++ )
            {

                displacements.push(dist/Math.max(Math.pow(x-lightSources[i][0], shininess)+
                Math.pow(y-lightSources[i][1], shininess)+Math.pow(z-lightSources[i][2], shininess), 0.01))
                angSThetas.push(co(Math.PI/2+Math.atan(lightSources[i][2]/Math.max(lightSources[i][0], 0.01))))
                angSPhis.push(co(Math.PI/2+Math.atan(lightSources[i][2]/Math.max(lightSources[i][1], 0.01))))
                angLThetas.push(1/Math.max(Math.pow(co(angSThetas[i])-co(lTheta), 2), 0.01))
                angLPhis.push(1/Math.max(Math.pow(co(angSPhis[i])-co(lPhi), 2), 0.01))
            
            }
            
            var displacement = 0
            var angLTheta = 0
            var angLPhi = 0

            for ( var i = 0; i < lightSources.length; i++ )
            {

                displacement+=displacements[i]
                angLTheta+=angLThetas[i]
                angLPhi+=angLPhis[i]

            }

            return mini(luminosity*(mini(displacement)+1/distW*(mini(angLTheta)+mini(angLPhi))))

        };
        var project2d = function(x, y, z)
        {

            away = (y-y_Ra[0])/(y_Ra[1]-y_Ra[0])
            avg = (y_Ra[1]-y_Ra[0]+x_Ra[1]-x_Ra[0])/2
            return [1/4*away+(-1/2*away+1)*(x-x_Ra[0])/(x_Ra[1]-x_Ra[0]),away+z/avg]

        }
        var project = function(x, y, z)
        {

            return project2d(i_hat[0]*x+j_hat[0]*y, i_hat[1]*x+j_hat[1]*y, z)

        }


        c.scale(1, -1)
        c.translate(0, -h)

        var plane = function(x1, y1, z1, x2, y2, z2, x3, y3, z3, hue)
        {

            var thetaDen = [x2-x1, x3-x1, x3-x2]
            var phiDen = [y2-y1, y3-y1, y3-y2]
            for ( var i = 0; i < 3; i++ )
            {

                if ( thetaDen[i] == 0 ){ thetaDen[i] = 0.01 }
                if ( phiDen[i] == 0 ){ phiDen[i] = 0.01 }

            }
            var lTheta = (Math.atan((z2-z1)/thetaDen[0])+Math.atan((z3-z1)/thetaDen[1])+
            Math.atan((z3-z2)/thetaDen[2])/3)
            var lPhi = (Math.atan((z2-z1)/phiDen[0])+Math.atan((z3-z1)/phiDen[1])+
            Math.atan((z3-z2)/phiDen[2]))/3
            var p1 = project(x1, y1, z1)
            var p2 = project(x2, y2, z2)
            var p3 = project(x3, y3, z3)
            var dist1 = Math.sqrt(Math.pow(w/2*(p1[0]-p2[0]), 2)+Math.pow(h/2*(p1[1]-p2[1]), 2))
            var dist2 = Math.sqrt(Math.pow(w/2*(p1[0]-p3[0]), 2)+Math.pow(h/2*(p1[1]-p3[1]), 2))
            var dist = Math.max(dist1, dist2)
            if ( dist = dist2 ){ 
                var p = p3
                var co = [x3, y3, z3]
            }
            else { 
                var p = p2 
                var co = [x2, y2, z2]
            }
            var grad = c.createLinearGradient(w/4+w/2*p1[0], h/4+h/2*p1[1], w/4+w/2*p[0], h/4+h/2*p[1])
            var intensity = brightness(x1, y1, z1, lTheta, lPhi)
            hue1 = blend(hue, intensity)
            grad.addColorStop(0, "rgb("+hue1[0]+","+hue1[1]+","+hue1[2]+")")
            intensity = brightness(co[0], co[1], co[2], lTheta, lPhi)
            hue2 = blend(hue, intensity)
            grad.addColorStop(1, "rgb("+hue2[0]+","+hue2[1]+","+hue2[2]+")")
            c.fillStyle = grad
            c.beginPath()
            c.moveTo(w/4+w/2*p1[0], h/4+h/2*p1[1])
            c.lineTo(w/4+w/2*p2[0], h/4+h/2*p2[1])
            c.lineTo(w/4+w/2*p3[0], h/4+h/2*p3[1])
            c.lineTo(w/4+w/2*p1[0], h/4+h/2*p1[1])
            c.fill()

        }

        var v = true
        var refresh = function()
        {

            if ( theta >= 2*Math.PI )
            {

                theta = 0+theta-2*Math.PI

            }

            if ( Math.tan(theta) >= 0 )
            {

                if ( theta > Math.PI )
                {

                    i_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f2(i_hat[0])

                }
                else {

                    i_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f1(i_hat[0])

                }

            }
            else
            {

                if ( theta > Math.PI )
                {
                
                    i_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f2(i_hat[0])

                }
                else {

                    i_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f1(i_hat[0])

                }  

            }

            var nTheta = (theta+Math.PI/2)%(2*Math.PI)
            if ( Math.tan(nTheta) >= 0 )
            {

                if ( nTheta > Math.PI )
                {

                    j_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f2(j_hat[0])

                }
                else {
                    
                    j_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f1(j_hat[0])

                }

            }
            else
            {

                if ( nTheta > Math.PI )
                {

                    j_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f2(j_hat[0])

                }
                else {
                    
                    j_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f1(j_hat[0])

                }  

            }


            c.fillStyle = "white"
            c.fillRect(0, 0, w, h)

            plane(-1, -1, 0, 1, -1, 0, 1, 1, 0, [146, 56, 29])
            plane(-1, -1, 0, 1, 1, 0, -0.5, 0.5, 0, [146, 56, 29])
            plane(-1, -1, 0, -0.5, 0.5, 0, -1, 1, 0, [95, 120, 54])
            plane(1, 1, 0, -0.5, 0.5, 0, -1, 1, 0, [95, 120, 54])
            plane(-0.75, -0.75, 0, 0.75, 0.75, 0, 0.75, -0.75, 0, [95, 120, 54])
            plane(0.25, -0.25, 0, 0.25, -0.5, 0, 0.5, -0.25, 0, [146, 56, 29])
            plane(1, -1, 0, 1, -1, 0.5, 0.5, -1, 0, [164, 163, 159])
            plane(1, -1, 0.5, 0.5, -1, 0, 0.5, -1, 0.5, [164, 163, 159])
            plane(1, -1, 0, 1, -1, 0.5, 1, -0.5, 0, [164, 163, 159])
            plane(1, -1, 0.5, 1, -0.5, 0, 1, -0.5, 0.5, [164, 163, 159])
            plane(-1, -1, 0, -1, 1, 0, -1, 1, 0.5, [106, 202, 201])
            plane(1, 1, 0, -1, 1, 0, -1, 1, 0.5, [106, 202, 201])
            plane(1, -1, 0, 1, -1, 0.5, 1, -0.5, 0, [164, 163, 159])

            c.fillStyle = "rgba(255,255,255,"+mini(luminosity)+")"
            c.font = "24px Times"
            p1 = project(0, 0, 0)
            c.beginPath()
            c.arc(w/4+w/2*p1[0], h/4+h/2*p1[1], 5, 0, 2*Math.PI)
            c.fill()

            window.requestAnimationFrame(refresh)

        }

        var moveV = false
        var pX;
        var rotate = function(e)
        {

            if ( !window.touchCheck )
            {
          
                if ( !pX ){ pX = e.clientX }
                theta+=beta*(e.clientX-pX)
                pX = e.clientX

            }
            if ( moveV ){ theta+=beta*e.movementX }
            if ( theta < 0 ){ theta = 2*Math.PI+theta }
            theta%=2*Math.PI

        }
       
        window.addEventListener("mousemove", rotate)
        window.addEventListener("touchmove", rotate)
        window.addEventListener("mousedown", function(){ moveV = true })
        window.addEventListener("mouseup", function(){ moveV = false })

        refresh()

    </script>
</html>
