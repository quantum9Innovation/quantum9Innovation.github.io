<!DOCTYPE html>
<html>
    <head>

      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Grafish</title>
      <link rel="shortcut icon" href="https://ibb.co/6ywDhbt" >

    </head>
    <style>
    
        body {

            background-color: rgb(0, 0, 0)

        }
        p {

            font-family: "times new roman";
            font-size: 24px;
            color: white;
            position: absolute;
            left: 15px;
            top: 15px;
            width: 250px

        }


        #me {

            margin: auto

        }

    </style>
    <body>

        <p><em>Taylor Series approximation of sin(xy)</em></p>
        <canvas id="me" >Start streaming on a modern browser!</canvas>

    </body>
    <script>

        var el = document.getElementById("me")
            el.width = window.innerWidth*0.95
            el.height = window.innerHeight*0.9

        var c = el.getContext("2d")
            var w = c.canvas.width
            var h = c.canvas.height

  
        var f = function(x, y)
        {

            return x*y-Math.pow(x*y, 3)/6+Math.pow(x*y, 5)/120-Math.pow(x*y, 7)/5040

        };


         var x_Ra = [-2, 2]
        var y_Ra = [-2, 2]

        var theta = 0
        var rotationSpeed = Math.PI/100

        
        var f1 = function(x)
        {return Math.sqrt(-Math.pow(x, 2)+1)}
        var f2 = function(x)
        {return -Math.sqrt(-Math.pow(x, 2)+1)}

        var i_hat = [1, 0]
        var j_hat = [0, 1]

            if ( Math.tan(theta) >= 0 )
            {

                if ( theta > Math.PI )
                {

                    i_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f2(i_hat[0])

                }
                else {

                    i_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f1(i_hat[0])

                }

            }
            else
            {

                if ( theta > Math.PI )
                {
                
                    i_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f2(i_hat[0])

                }
                else {

                    i_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f1(i_hat[0])

                }  

            }

            var nTheta = theta+Math.PI/2
            if ( Math.tan(nTheta) >= 0 )
            {

                if ( nTheta > Math.PI )
                {

                    j_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f2(j_hat[0])

                }
                else {
                    
                    j_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f1(j_hat[0])

                }

            }
            else
            {

                if ( nTheta > Math.PI )
                {

                    j_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f2(j_hat[0])

                }
                else {
                    
                    j_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f1(j_hat[0])

                }  

            }


        var brightness = function(x, y, z)
        {

            dist = Math.sqrt(Math.pow(x-x_Ra[0], 2)+Math.pow(y-y_Ra[0], 2)+Math.pow(z, 2))
            avg = (x_Ra[1]-x_Ra[0]+y_Ra[1]-y_Ra[0])/2
            maxDist = Math.sqrt(Math.pow(x_Ra[1]-x_Ra[0], 2)+Math.pow(y_Ra[1]-y_Ra[0], 2)+Math.pow(avg, 2))
            return maxDist/Math.pow(dist, 2)

        };
        var project2d = function(x, y, z)
        {

            away = (y-y_Ra[0])/(y_Ra[1]-y_Ra[0])
            return [1/4*away+(-1/2*away+1)*(x-x_Ra[0])/(x_Ra[1]-x_Ra[0]),away+z/(y_Ra[1]-y_Ra[0])]

        }
        var project = function(x, y, z)
        {

            return project2d(i_hat[0]*x+j_hat[0]*y, i_hat[1]*x+j_hat[1]*y, z)

        }


        var evalPts = []
        var steps = 64
        var i = 0
        for ( var x = x_Ra[0]; x <= x_Ra[1]; x+=(x_Ra[1]-x_Ra[0])/steps )
        {

            evalPts.push([])
            for ( var y = y_Ra[0]; y <= y_Ra[1]; y+=(y_Ra[1]-y_Ra[0])/steps )
            {

                evalPts[i].push(f(x, y))

            }
            i++

        }

        c.scale(1, -1)
        c.translate(0, -h)

        var refresh = function()
        {

            if ( Math.tan(theta) >= 0 )
            {

                if ( theta > Math.PI )
                {

                    i_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f2(i_hat[0])

                }
                else {

                    i_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f1(i_hat[0])

                }

            }
            else
            {

                if ( theta > Math.PI )
                {
                
                    i_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f2(i_hat[0])

                }
                else {

                    i_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(theta), 2)))
                    i_hat[1] = f1(i_hat[0])

                }  

            }

            var nTheta = theta+Math.PI/2
            if ( Math.tan(nTheta) >= 0 )
            {

                if ( nTheta > Math.PI )
                {

                    j_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f2(j_hat[0])

                }
                else {
                    
                    j_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f1(j_hat[0])

                }

            }
            else
            {

                if ( nTheta > Math.PI )
                {

                    j_hat[0] = Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f2(j_hat[0])

                }
                else {
                    
                    j_hat[0] = -Math.sqrt(-1/(-1-Math.pow(Math.tan(nTheta), 2)))
                    j_hat[1] = f1(j_hat[0])

                }  

            }


            c.fillStyle = "black"
            c.fillRect(0, 0, w, h)

            c.strokeStyle = "white"
            c.beginPath()
            c.moveTo(w/4, h/4)
            c.lineTo(3*w/4, h/4)
            c.lineTo(5*w/8, 3*h/4)
            c.lineTo(3*w/8, 3*h/4)
            c.lineTo(w/4, h/4)
            c.stroke()

            var ix = 0
            var iy = 0
            for ( var x = x_Ra[0]; x < x_Ra[1]; x+=(x_Ra[1]-x_Ra[0])/steps )
            {

                iy = 0
                for ( var y = y_Ra[0]; y < y_Ra[1]; y+=(y_Ra[1]-y_Ra[0])/steps )
                {

                    light = brightness(x, y, evalPts[ix][iy])
                    if ( ix%2 == iy%2 )
                    {
                        
                        c.fillStyle = "rgba(115, 200, 200,"+light+")"
                    
                    }
                    else {
                        
                        c.fillStyle = "rgba(55, 125, 140,"+light+")"
                    
                    }
                    
                    p1 = project(x, y, evalPts[ix][iy])
                    p2 = project(x+(x_Ra[1]-x_Ra[0])/steps, y, evalPts[ix+1][iy])
                    p3 = project(x+(x_Ra[1]-x_Ra[0])/steps, y+(y_Ra[1]-y_Ra[0])/steps, evalPts[ix+1][iy+1])
                    p4 = project(x, y+(y_Ra[1]-y_Ra[0])/steps, evalPts[ix][iy+1])
                    
                    c.beginPath()
                    c.moveTo(w/4+w/2*p1[0], h/4+h/2*p1[1])
                    c.lineTo(w/4+w/2*p2[0], h/4+h/2*p2[1])
                    c.lineTo(w/4+w/2*p3[0], h/4+h/2*p3[1])
                    c.lineTo(w/4+w/2*p4[0], h/4+h/2*p4[1])
                    c.lineTo(w/4+w/2*p1[0], h/4+h/2*p1[1])
                    c.fill()
                    iy++

                }

                ix++

            }
           
            theta+=rotationSpeed
            window.requestAnimationFrame(refresh)

        }

        refresh()

    </script>
</html>
